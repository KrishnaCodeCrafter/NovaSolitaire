System.register("chunks:///_virtual/Card.ts",["./rollupPluginModLoBabelHelpers.js","cc","./flip.ts","./GameManager.ts"],(function(e){var t,i,n,a,o,r,s,l,d,c,h,g,u,p,f,v,m,y,S,C,T,_,k,b,D;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.createForOfIteratorHelperLoose,a=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,s=e._decorator,l=e.Enum,d=e.Node,c=e.SpriteFrame,h=e.AudioClip,g=e.AudioSource,u=e.Vec2,p=e.UITransform,f=e.Vec3,v=e.math,m=e.tween,y=e.isValid,S=e.Tween,C=e.UIOpacity,T=e.Layout,_=e.Sprite,k=e.Component},function(e){b=e.CardFlipper},function(e){D=e.GameManager}],execute:function(){var M,P,w,N,A,O,W,E,V,I,F,x,U,R,H,L,z,X,B,K,G,q,Z;r._RF.push({},"818d2qZROFA8ZurEqmTgLGG","Card",void 0);var j=s.ccclass,J=s.property,Q=e("HolderType",function(e){return e[e.TABLEAU=1]="TABLEAU",e[e.FOUNDATION=2]="FOUNDATION",e[e.STOCK=3]="STOCK",e[e.WASTE=4]="WASTE",e}({}));e("CardLogic",(M=j("CardLogic"),P=J({type:l(Q)}),w=J(d),N=J(d),A=J(d),O=J(c),W=J(c),E=J(c),V=J(h),I=J(h),F=J(D),M((R=t((U=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,a(t,"holderType",R,o(t)),a(t,"placeholderNode",H,o(t)),a(t,"visualDeckTop",L,o(t)),a(t,"emptyStockVisual",z,o(t)),a(t,"wrongClickSprite",X,o(t)),a(t,"ringSprite",B,o(t)),a(t,"starSprite",K,o(t)),a(t,"successSound",G,o(t)),a(t,"errorSound",q,o(t)),a(t,"gameManager",Z,o(t)),t._audioSource=null,t._isAnimating=!1,t._isDragging=!1,t._dragThresholdPassed=!1,t._dragStartPos=new u,t._dragOffset=new f,t._draggedCards=[],t._currentVelocityX=0,t._activeHighlightTarget=null,t._originalParent=null,t._originalPositions=[],t._originalSiblingIndices=[],t}i(t,e);var r=t.prototype;return r.onLoad=function(){this._audioSource=this.getComponent(g)||this.addComponent(g),this.node.on(d.EventType.TOUCH_START,this.onTouchStart,this),this.updatePlaceholderVisibility()},r.onTouchStart=function(e){var t=this;if(this.gameManager&&this.gameManager.resetIdleTimer(),!this._isAnimating)if(this.holderType!==Q.STOCK&&this.holderType!==Q.FOUNDATION){var i=e.getUILocation(),n=this.getCardUnderTouch(i);if(n&&!n.name.includes("faceDown")){var a=this.node.children,o=a.indexOf(n);if(this._draggedCards=a.slice(o).filter((function(e){return e.active&&e!==t.placeholderNode})),0!==this._draggedCards.length){this._isDragging=!0,this._dragThresholdPassed=!1,this._dragStartPos.set(i.x,i.y),this._currentVelocityX=0;var r=n.getWorldPosition();this._dragOffset.set(r.x-i.x,r.y-i.y,0),this.node.on(d.EventType.TOUCH_MOVE,this.onDragMove,this),this.node.on(d.EventType.TOUCH_END,this.onDragEnd,this),this.node.on(d.EventType.TOUCH_CANCEL,this.onDragEnd,this)}}else this.handleStandardClick(e)}else this.handleStandardClick(e)},r.onDragMove=function(e){if(this._isDragging){var t=e.getUILocation();if(!this._dragThresholdPassed){if(!(u.distance(this._dragStartPos,t)>10))return;this._dragThresholdPassed=!0,this.startDraggingVisuals()}if(this._draggedCards.length>0&&this.gameManager.globalOverlay){var i=this.gameManager.globalOverlay.getComponent(p),n=new f(0,80,0),a=new f(t.x,t.y,0).add(this._dragOffset).add(n),o=i.convertToNodeSpaceAR(a),r=o.x-this._draggedCards[0].position.x;this._currentVelocityX=v.lerp(this._currentVelocityX,r,.5);var s=v.clamp(1.5*-this._currentVelocityX,-15,15);this._draggedCards[0].setPosition(o);var l=this._draggedCards[0].angle;this._draggedCards[0].angle=v.lerp(l,s,.2);for(var d=1;d<this._draggedCards.length;d++){var c=this._draggedCards[d],h=this._draggedCards[d-1],g=h.position.clone();g.y-=45;var m=v.lerp(c.position.x,g.x,.45),y=v.lerp(c.position.y,g.y,.45);c.setPosition(m,y,0),c.angle=v.lerp(c.angle,.9*h.angle,.2)}this.checkAndHighlightTarget()}}},r.onDragEnd=function(e){if(this.node.off(d.EventType.TOUCH_MOVE,this.onDragMove,this),this.node.off(d.EventType.TOUCH_END,this.onDragEnd,this),this.node.off(d.EventType.TOUCH_CANCEL,this.onDragEnd,this),this._isDragging=!1,this._activeHighlightTarget&&(this._activeHighlightTarget.setHighlightState(!1),this._activeHighlightTarget=null),!this._dragThresholdPassed)return this._draggedCards=[],void this.handleStandardClick(e);this._draggedCards.forEach((function(e){m(e).to(.1,{angle:0}).start()})),this.attemptDrop()},r.checkAndHighlightTarget=function(){for(var e,i=this._draggedCards[0],a=(i.getComponent(p),i.getWorldPosition()),o=[].concat(this.gameManager.tableauNodes,this.gameManager.foundationNodes),r=null,s=200,l=n(o);!(e=l()).done;){var d=e.value,c=d.getComponent(t);if(c&&c!==this){var h=d.getWorldPosition(),g=c.node.children.filter((function(e){return e.active&&e.name.startsWith("card")}));g.length>0&&(h=g[g.length-1].getWorldPosition());var u=f.distance(a,h);u<s&&this.checkSpecificDropValidity(i,c)&&(s=u,r=c)}}r!==this._activeHighlightTarget&&(this._activeHighlightTarget&&this._activeHighlightTarget.setHighlightState(!1),r&&r.setHighlightState(!0),this._activeHighlightTarget=r)},r.setHighlightState=function(e){var t=this,i=null,n=this.node.children.filter((function(e){return e.active&&e!==t.placeholderNode&&(e.name.startsWith("card")||e.name.includes("faceDown"))}));n.length>0?i=n[n.length-1]:this.placeholderNode&&y(this.placeholderNode)&&(i=this.placeholderNode),i&&(S.stopAllByTarget(i),e?m(i).to(.15,{scale:new f(1.15,1.15,1)},{easing:"sineOut"}).start():m(i).to(.15,{scale:new f(1,1,1)},{easing:"sineOut"}).start())},r.startDraggingVisuals=function(){var e=this.gameManager.globalOverlay;if(e){var t=e.getComponent(p);this._originalParent=this.node,this._originalPositions=this._draggedCards.map((function(e){return e.getPosition().clone()})),this._originalSiblingIndices=this._draggedCards.map((function(e){return e.getSiblingIndex()})),this._draggedCards.forEach((function(i,n){var a=i.getWorldScale().clone(),o=i.getWorldPosition(),r=t.convertToNodeSpaceAR(o);i.setParent(e),i.setPosition(r),i.setWorldScale(a);var s=i.getScale();m(i).to(.1,{scale:new f(1.2*s.x,1.2*s.y,1)},{easing:"backOut"}).start(),(i.getComponent(C)||i.addComponent(C)).opacity=255}))}},r.attemptDrop=function(){for(var e,i=this._draggedCards[0],a=i.getWorldPosition(),o=[].concat(this.gameManager.tableauNodes,this.gameManager.foundationNodes),r=null,s=1e3,l=n(o);!(e=l()).done;){var d=e.value,c=d.getComponent(t);if(c&&c!==this){var h=d.getWorldPosition(),g=c.node.children.filter((function(e){return e.active&&e.name.startsWith("card")}));g.length>0&&(h=g[g.length-1].getWorldPosition());var u=f.distance(a,h);u<150&&u<s&&this.checkSpecificDropValidity(i,c)&&(s=u,r=c)}}r?(console.log("[CardLogic] ðŸŽ¯ Drop valid on "+r.node.name),this._draggedCards.forEach((function(e){(e.getComponent(C)||e.addComponent(C)).opacity=255})),this.executeStackMove(this._draggedCards,r),this._draggedCards=[]):this.returnCardsToOriginal()},r.checkSpecificDropValidity=function(e,t){var i=this.getCardData(e);if(!i)return!1;var n=t.node.children.filter((function(e){return e.active&&e!==t.placeholderNode&&e.name.startsWith("card")}));if(0===n.length){if(t.holderType===Q.TABLEAU)return 12===i.value;if(t.holderType===Q.FOUNDATION)return 0===i.value&&1===this._draggedCards.length}else{var a=n[n.length-1],o=this.getCardData(a);if(!o)return!1;if(t.holderType===Q.TABLEAU)return i.isRed!==o.isRed&&o.value===i.value+1;if(t.holderType===Q.FOUNDATION)return i.suit===o.suit&&i.value===o.value+1&&1===this._draggedCards.length}return!1},r.returnCardsToOriginal=function(){var e=this;console.log("[CardLogic] â†©ï¸ Drop invalid. Returning.");var t=this.gameManager.globalOverlay.getComponent(p),i=this._originalParent.getComponent(p),n=[].concat(this._draggedCards),a=[].concat(this._originalPositions),o=[].concat(this._originalSiblingIndices),r=this._originalParent;this._draggedCards=[],this._isAnimating=!0;var s=0,l=n.length;0!==l?n.forEach((function(d,c){var h=a[c],g=i.convertToWorldSpaceAR(h),u=t.convertToNodeSpaceAR(g);m(d).parallel(m().to(.3,{position:u},{easing:"sineOut"}),m().to(.3,{angle:0},{easing:"sineOut"}),m().to(.2,{scale:new f(1,1,1)})).call((function(){++s===l&&e.finalizeReturn(n,a,o,r)})).start()})):this._isAnimating=!1},r.finalizeReturn=function(e,t,i,n){e.forEach((function(e,a){y(e)&&y(n)&&(e.setParent(n),e.setPosition(t[a]),e.setSiblingIndex(i[a]),(e.getComponent(C)||e.addComponent(C)).opacity=255)})),this._isAnimating=!1},r.getCardUnderTouch=function(e){for(var t=this.node.children.length-1;t>=0;t--){var i=this.node.children[t];if(i.active&&i!==this.placeholderNode){var n=i.getComponent(p);if(n&&n.isHit(e))return i}}return null},r.handleStandardClick=function(e){var t=this;if(this.holderType===Q.FOUNDATION)return this.playSFX(this.errorSound),void this.showWrongFeedback(e,null);if(!this._isAnimating)if(this.holderType!==Q.STOCK){if(!this.node.getComponentsInChildren(b).some((function(e){return e.isFlipping}))){var i=this.node.children.filter((function(e){return e!==t.placeholderNode&&e!==t.visualDeckTop&&e!==t.emptyStockVisual&&e.active&&e.name.startsWith("card")}));if(i.length>0){var n=i[i.length-1],a=this.getCardData(n);if(a&&this.findFoundationMove(a,[n]))return;if(this.holderType===Q.WASTE){if(a&&this.findValidMove(a,[n]))return}else for(var o=0;o<i.length;o++){var r=i[o],s=this.getCardData(r),l=i.slice(o);if(s&&this.findValidMove(s,l))return}}this.playSFX(this.errorSound),this.showWrongFeedback(e,this.getCardUnderTouch(e.getUILocation()))}}else this.handleStockClick()},r.handleStockClick=function(){var e=this;if(this.gameManager&&this.gameManager.wasteNode&&!(this._isAnimating||this.emptyStockVisual&&this.emptyStockVisual.active)){var i=this.gameManager.wasteNode,n=i.getComponent(t),a=this.node.children.filter((function(t){return t!==e.placeholderNode&&t!==e.visualDeckTop&&t!==e.emptyStockVisual&&t.name.startsWith("card")}));if(a.length>0){var o=a[a.length-1];this.playSFX(this.successSound),this._isAnimating=!0,o.setSiblingIndex(this.node.children.length-1),n?this.executeStackMove([o],n,(function(){e._isAnimating=!1})):this._isAnimating=!1,a.length-1==0&&this.visualDeckTop&&(this.visualDeckTop.active=!1)}else{var r=i.children.filter((function(e){return e.name.startsWith("card")&&e!==(null==n?void 0:n.placeholderNode)}));if(0===r.length)return this.emptyStockVisual&&(this.emptyStockVisual.active=!0),this.placeholderNode&&(this.placeholderNode.active=!1),this.visualDeckTop&&(this.visualDeckTop.active=!1),void this.playSFX(this.errorSound);this.playSFX(this.successSound),this._isAnimating=!0;var s=r.reverse(),l=this.gameManager.globalOverlay,d=l.getComponent(p),c=this.node.getWorldPosition(),h=new f;h=d?d.convertToNodeSpaceAR(c):c;var g=0,u=s.length;s.forEach((function(t,i){var n=t.getWorldPosition().clone(),a=t.getWorldScale().clone();t.setParent(l),t.setWorldScale(a);var o=t.scale.clone(),r=d?d.convertToNodeSpaceAR(n):n;t.setPosition(r),t.setSiblingIndex(999+i);var s=.45,c=.035*i;m(t).delay(c).parallel(m().to(s,{position:h},{easing:"cubicInOut"}),m().to(.225,{scale:new f(0,o.y,o.z)}).call((function(){var e=t.getComponent(b);e&&e.setFaceDown()})).to(.225,{scale:o})).call((function(){t.setParent(e.node),t.setPosition(0,0,0),t.setScale(1,1,1),++g===u&&(e.visualDeckTop&&(e.visualDeckTop.active=!0,e.visualDeckTop.setSiblingIndex(e.node.children.length-1)),e.updatePlaceholderVisibility(),e._isAnimating=!1)})).start()})),n&&n.updatePlaceholderVisibility()}}},r.executeStackMove=function(e,t,i){var n=this;if(this.gameManager&&this.gameManager.globalOverlay){var a=this.gameManager.globalOverlay,o=a.getComponent(p),r=t.getComponent(T);if(this.gameManager&&this.gameManager.addValidMove(this.node),this.holderType!==Q.STOCK){var s=e.map((function(e){return e.getWorldPosition().clone()})),l=e.map((function(e){return e.getWorldScale().clone()}));e.forEach((function(e){(e.getComponent(C)||e.addComponent(C)).opacity=0,e.setParent(t.node)})),t.updatePlaceholderVisibility(),r&&r.updateLayout(),this.updatePlaceholderVisibility(),t.node.updateWorldTransform(),e.forEach((function(e){return e.updateWorldTransform()}));var d=e.map((function(e){return e.getWorldPosition().clone()})),c=e.map((function(e){return e.getPosition().clone()}));e.forEach((function(e,t){e.setParent(a),e.setWorldPosition(s[t]),e.setWorldScale(l[t]),(e.getComponent(C)||e.addComponent(C)).opacity=255}));var h=0,g=e.length;e.forEach((function(a,s){var l=o?o.convertToNodeSpaceAR(d[s]):d[s],u=a.position.clone(),p=a.scale.clone(),v=(u.x+l.x)/2,S=(u.y+l.y)/2+150,C=new f(v,S,0),T=20*Math.random()-10,_=.45,k=.05*s;a.setSiblingIndex(999),m(a).delay(k).parallel(m().to(.225,{position:C},{easing:"sineOut"}).to(.225,{position:l},{easing:"quadIn"}),m().to(.225,{scale:new f(1.2*p.x,1.2*p.y,1)},{easing:"sineOut"}).to(.225,{scale:p},{easing:"sineIn"}),m().to(.8*_,{angle:T}).to(.2*_,{angle:0})).call((function(){t.node&&y(t.node)&&(a.setParent(t.node),a.setPosition(c[s]),a.setScale(new f(1,1,1)),m(a).to(.1,{scale:new f(1.05,.95,1)}).to(.15,{scale:new f(1,1,1)}).start(),++h===g&&(e.forEach((function(e){e.parent&&e.setSiblingIndex(e.parent.children.length-1)})),n.playSuccessEffect(e[e.length-1]),n.checkAndFlipRevealedCard(),r&&r.updateLayout(),n.holderType===Q.WASTE&&n.checkDeckDepletion(),i&&i()))})).start()}))}else{var u=0,v=e.length;e.forEach((function(e){var r=e.getWorldPosition().clone(),s=e.getWorldScale().clone(),l=t.node.getWorldPosition().clone();e.setParent(a),e.setWorldScale(s);var d=e.scale.clone(),c=o?o.convertToNodeSpaceAR(r):r,h=o?o.convertToNodeSpaceAR(l):l;e.setPosition(c);var g=(c.x+h.x)/2,p=(c.y+h.y)/2+60,S=new f(g,p,0),C=4*Math.random()-2;e.setSiblingIndex(999);var T=.35;m(e).parallel(m().to(.175,{position:S},{easing:"sineOut"}).to(.175,{position:h},{easing:"sineIn"}),m().to(.175,{scale:new f(0,1.15*d.y,d.z)},{easing:"sineIn"}).call((function(){var t=e.getComponent(b),i=e.getComponent(_);t&&i&&t.faceUpSprite&&(i.spriteFrame=t.faceUpSprite,e.name=t.faceUpSprite.name)})).to(.175,{scale:d},{easing:"sineOut"}),m().to(T,{angle:C})).call((function(){t.node&&y(t.node)&&(e.setParent(t.node),e.setPosition(0,0,0),e.setScale(1,1,1),e.angle=C,m(e).to(.1,{scale:new f(1.05,.95,1)}).to(.15,{scale:new f(1,1,1)}).start(),n.updatePlaceholderVisibility(),t.updatePlaceholderVisibility()),++u===v&&i&&i()})).start()}))}}else i&&i()},r.findFoundationMove=function(e,i){if(i.length>1)return!1;if(!this.gameManager||!this.gameManager.foundationNodes)return!1;for(var a,o=n(this.gameManager.foundationNodes);!(a=o()).done;){var r=a.value.getComponent(t);if(r){var s=r.node.children.filter((function(e){return e.name.startsWith("card")&&!e.name.includes("foundation_A")})),l=0===s.length;if(l&&0===e.value)return this.executeStackMove(i,r),!0;if(!l){var d=s[s.length-1],c=this.getCardData(d);if(c&&c.suit===e.suit&&e.value===c.value+1)return this.executeStackMove(i,r),!0}}}return!1},r.findValidMove=function(e,i){var a=this;if(!this.gameManager||!this.gameManager.tableauNodes)return!1;for(var o,r,s=function(){var n=r.value.getComponent(t);if(!n||n===a||n.holderType!==Q.TABLEAU)return 0;var o=n.node.children.filter((function(e){return e!==n.placeholderNode&&(e.name.startsWith("card")||e.name.includes("faceDown"))}));if(0===o.length){if(12===e.value)return a.executeStackMove(i,n),{v:!0}}else{var s=o[o.length-1],l=a.getCardData(s);if(l&&l.isRed!==e.isRed&&l.value===e.value+1)return a.executeStackMove(i,n),{v:!0}}},l=n(this.gameManager.tableauNodes);!(r=l()).done;)if(0!==(o=s())&&o)return o.v;return!1},r.getCardData=function(e){if(!e.active||"default"===e.name||e.name.includes("faceDown")||e.name.includes("foundation_A")||e===this.visualDeckTop||e===this.emptyStockVisual||"WrongClickFeedback"===e.name||!e.name.startsWith("card"))return null;var t=e.name.replace("card",""),i=parseInt(t);return isNaN(i)?null:{value:i%13,suit:Math.floor(i/13),isRed:1===Math.floor(i/13)||2===Math.floor(i/13),node:e}},r.checkDeckDepletion=function(){var e=this;if(this.gameManager&&this.gameManager.stockNode&&!(this.node.children.filter((function(t){return t.name.startsWith("card")&&t!==e.placeholderNode})).length>0)){var i=this.gameManager.stockNode,n=i.getComponent(t);0===i.children.filter((function(e){return e.name.startsWith("card")||e.name.includes("faceDown")})).filter((function(e){return e!==(null==n?void 0:n.visualDeckTop)&&e!==(null==n?void 0:n.emptyStockVisual)})).length&&n&&(n.emptyStockVisual&&(n.emptyStockVisual.active=!0),n.visualDeckTop&&(n.visualDeckTop.active=!1),n.placeholderNode&&(n.placeholderNode.active=!1))}},r.checkAndFlipRevealedCard=function(){var e=this,t=this.node.children.filter((function(t){return t!==e.placeholderNode&&t!==e.visualDeckTop&&t!==e.emptyStockVisual&&(t.name.includes("faceDown")||t.name.startsWith("card"))}));if(t.length>0){var i=t[t.length-1];if(i.name.includes("faceDown")){var n=i.getComponent(b);n&&(n.flipToFaceUp(),i.name.startsWith("card")||(i.name=i.name.replace("faceDown_","").replace("faceDown","")))}}},r.showWrongFeedback=function(e,t){var i,n,a=(null==(i=this.gameManager)?void 0:i.globalOverlay)||(null==(n=this.gameManager)?void 0:n.node)||this.node.parent||this.node,o=e.getUILocation(),r=new f(o.x,o.y,0),s=a.getComponent(p),l=s?s.convertToNodeSpaceAR(r):r,c=new d("WrongClickFeedback");a.addChild(c),c.setPosition(l),c.setSiblingIndex(999);var h=c.addComponent(_);h.spriteFrame=this.wrongClickSprite,h.sizeMode=_.SizeMode.RAW;var g=c.addComponent(C);if(g.opacity=0,c.addComponent(p).setContentSize(80,80),c.angle=40*Math.random()-20,c.setScale(new f(.5,.5,1)),m(c).to(.15,{scale:new f(1.2,1.2,1)},{easing:"backOut"}).delay(.2).parallel(m().by(.4,{position:new f(0,40,0)},{easing:"sineOut"}),m().to(.4,{scale:new f(.8,.8,1)})).call((function(){y(c)&&c.destroy()})).start(),m(g).to(.1,{opacity:255}).delay(.25).to(.4,{opacity:0}).start(),t&&y(t)&&t!==this.node){var u=t.name.startsWith("card"),v=t.name.includes("faceDown");if(u&&!v){S.stopAllByTarget(t);var T=t.angle;Math.abs(T)<15&&(T=0,t.angle=0),m(t).to(.05,{angle:T+10}).to(.1,{angle:T-10}).to(.1,{angle:T+6}).to(.1,{angle:T-6}).to(.05,{angle:T}).call((function(){t&&y(t)&&(t.angle=T)})).start()}}},r.playSFX=function(e){e&&this._audioSource&&this._audioSource.playOneShot(e,1)},r.playSuccessEffect=function(e){var t;this.playSFX(this.successSound);var i=new d("EffectContainer");null==(t=this.node.parent)||t.addChild(i),i.setWorldPosition(e.getWorldPosition());var n=new d("Ring");n.addComponent(_).spriteFrame=this.ringSprite;var a=n.addComponent(C);a.opacity=255,n.addComponent(p).setContentSize(200,200),i.addChild(n),n.setScale(0,0,1);m(n).to(.4,{scale:new f(2,2,1)},{easing:"backOut"}).start(),m(a).delay(.12).to(.4*.7,{opacity:0}).start();for(var o=0;o<30;o++){var r=new d("Particle");r.addComponent(_).spriteFrame=this.starSprite;var s=r.addComponent(C);s.opacity=255,r.addComponent(p).setContentSize(100,100),i.addChild(r);var l=360*Math.random()*Math.PI/180,c=300+150*(Math.random()-.5),h=.6+.3*(Math.random()-.5),g=.3+.4*Math.random();r.setScale(g,g,1);var u=c*h,v=Math.cos(l)*u,S=Math.sin(l)*u;m(r).to(h,{position:new f(v,S,0)},{easing:"sineOut"}).start(),m(s).to(.7*h,{opacity:255}).to(.3*h,{opacity:0}).start(),m(r).to(h,{scale:new f(.05,.05,1)},{easing:"sineIn"}).start()}m(i.addComponent(C)).delay(1).call((function(){y(i)&&i.destroy()})).start()},r.updatePlaceholderVisibility=function(){var e=this;if(this.placeholderNode)if(this.emptyStockVisual&&this.emptyStockVisual.active)this.placeholderNode.active=!1;else{var t=this.node.children.some((function(t){return t!==e.placeholderNode&&t!==e.visualDeckTop&&t!==e.emptyStockVisual&&t.active&&(t.name.startsWith("card")||t.name.includes("faceDown"))}));this.placeholderNode.active=!t;var i=this.getComponent(T);i&&i.updateLayout()}},t}(k)).prototype,"holderType",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Q.TABLEAU}}),H=t(U.prototype,"placeholderNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(U.prototype,"visualDeckTop",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(U.prototype,"emptyStockVisual",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(U.prototype,"wrongClickSprite",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(U.prototype,"ringSprite",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(U.prototype,"starSprite",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(U.prototype,"successSound",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(U.prototype,"errorSound",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(U.prototype,"gameManager",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=U))||x));r._RF.pop()}}}));

System.register("chunks:///_virtual/flip.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(e){var i,n,a,t,r,o,p,l,s,c,g,u,f;return{setters:[function(e){i=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.createClass,t=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,p=e._decorator,l=e.SpriteFrame,s=e.Sprite,c=e.tween,g=e.Vec3,u=e.Component},function(e){f=e.GameManager}],execute:function(){var d,m,h,F,w,S,v,C,y;o._RF.push({},"6f711Xzbz9Mi4X2ySWZA/Ir","flip",void 0);var b=p.ccclass,M=p.property;e("CardFlipper",(d=b("CardFlipper"),m=M(l),h=M(l),F=M(f),d((v=i((S=function(e){function i(){for(var i,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return i=e.call.apply(e,[this].concat(a))||this,t(i,"faceUpSprite",v,r(i)),t(i,"faceDownSprite",C,r(i)),t(i,"gameManager",y,r(i)),i._isFlipping=!1,i}n(i,e);var o=i.prototype;return o.onLoad=function(){this.gameManager||(this.gameManager=this.node.scene.getComponentInChildren(f)),console.log("[CardFlipper] Initialized on node: "+this.node.name)},o.flipToFaceUp=function(e){var i=this;if(!this._isFlipping){var n=this.node.name.includes("faceDown");console.log("[CardFlipper] flip called on: "+this.node.name+" | Is Hidden? "+n),this._isFlipping=!0;var a=this.getComponent(s);a?(e&&(this.faceUpSprite=e),c(this.node).to(.15,{scale:new g(0,1,1)},{easing:"sineIn"}).call((function(){i.faceUpSprite&&(a.spriteFrame=i.faceUpSprite,i.faceUpSprite.name&&(i.node.name=i.faceUpSprite.name),n&&(i.gameManager?(console.log("[CardFlipper] ðŸ“¢ Reporting Reveal to GameManager"),i.gameManager.onCardRevealed()):console.warn("[CardFlipper] âš ï¸ Card Revealed, but GameManager is missing!")))})).to(.15,{scale:new g(1,1,1)},{easing:"sineOut"}).call((function(){i._isFlipping=!1})).start()):this._isFlipping=!1}},o.setFaceDown=function(){var e=this.getComponent(s);e&&this.faceDownSprite&&(e.spriteFrame=this.faceDownSprite,this.node.name="faceDown",this.node.setScale(new g(1,1,1)),this._isFlipping=!1)},a(i,[{key:"isFlipping",get:function(){return this._isFlipping}}]),i}(u)).prototype,"faceUpSprite",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(S.prototype,"faceDownSprite",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=i(S.prototype,"gameManager",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=S))||w));o._RF.pop()}}}));

System.register("chunks:///_virtual/front_back.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,n,r,s,a,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Vec3,c=t.tween,u=t.Component}],execute:function(){var f,l,p,h,v,g;r._RF.push({},"92c12j1SSpBm4+zy4/la5Cb","front_back",void 0);var d=s.ccclass,y=s.property;t("DiagonalMover",(f=d("DiagonalMover"),l=y(a),f((v=e((h=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,i(e,"moveOffset",v,n(e)),i(e,"duration",g,n(e)),e._startPos=new a,e}o(e,t);var r=e.prototype;return r.onLoad=function(){this._startPos=this.node.getPosition(),this.startMoving()},r.startMoving=function(){var t=new a(this._startPos.x+this.moveOffset.x,this._startPos.y+this.moveOffset.y,this._startPos.z+this.moveOffset.z);c(this.node).repeatForever(c().to(this.duration,{position:this._startPos},{easing:"sineInOut"}).to(this.duration,{position:t},{easing:"sineInOut"})).start()},r.stopMoving=function(){c(this.node).stop()},e}(u)).prototype,"moveOffset",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new a(50,-50,0)}}),g=e(h.prototype,"duration",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),p=h))||p));r._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./stackOutline.ts"],(function(t){var e,n,i,o,a,r,s,c,l,u,h,d,p,f,v,g,m,y,N,C,b,w,M,S,_,P,T,O;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.createForOfIteratorHelperLoose,o=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,c=t.Node,l=t.AudioClip,u=t.Prefab,h=t.Label,d=t.CCInteger,p=t.UIOpacity,f=t.Vec3,v=t.tween,g=t.input,m=t.Input,y=t.UITransform,N=t.Tween,C=t.AudioSource,b=t.isValid,w=t.Color,M=t.view,S=t.instantiate,_=t.Sprite,P=t.math,T=t.Component},function(t){O=t.StackOutline}],execute:function(){var k,I,L,A,D,H,W,F,z,x,E,R,B,G,U,V,Y,q,Z,X,j,J,K,Q,$,tt,et,nt,it,ot,at,rt,st,ct,lt,ut,ht,dt,pt,ft;r._RF.push({},"2ff3eD5O6BLTJ/DZ09+e3Kw","GameManager",void 0);var vt=s.ccclass,gt=s.property;t("GameManager",(k=vt("GameManager"),I=gt(c),L=gt(c),A=gt(c),D=gt(c),H=gt(c),W=gt(c),F=gt(c),z=gt({type:l}),x=gt({type:l}),E=gt({type:u}),R=gt({type:c}),B=gt({type:h}),G=gt({type:d}),U=gt({type:[c]}),V=gt({type:[c]}),Y=gt({type:c}),q=gt({type:c}),Z=gt({type:O}),k((J=e((j=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,o(e,"introNode",J,a(e)),o(e,"handNode",K,a(e)),o(e,"popupNode",Q,a(e)),o(e,"mainNode",$,a(e)),o(e,"ctaScreen",tt,a(e)),o(e,"youLostScreen",et,a(e)),o(e,"globalOverlay",nt,a(e)),o(e,"bgmClip",it,a(e)),o(e,"cardDropSound",ot,a(e)),o(e,"confettiPrefab",at,a(e)),o(e,"confettiContainer",rt,a(e)),o(e,"movesLabel",st,a(e)),o(e,"maxMoves",ct,a(e)),o(e,"tableauNodes",lt,a(e)),o(e,"foundationNodes",ut,a(e)),o(e,"stockNode",ht,a(e)),o(e,"wasteNode",dt,a(e)),o(e,"stackOutline",pt,a(e)),o(e,"idleHintDelay",ft,a(e)),e._movesMade=0,e._isFirstMovePending=!0,e._isIntroShowing=!1,e._audioSource=null,e._gameWon=!1,e._gameOver=!1,e._isAutoPlaying=!1,e._idleTimer=0,e._isHintActive=!1,e._currentMoves=0,e._totalHiddenCards=21,e._revealedCount=0,e._animationComplete=!1,e}n(e,t);var r=e.prototype;return r.onLoad=function(){this.initBGM(),this.setupInitialState(),this.startSequence()},r.update=function(t){if(!this._gameWon&&!this._gameOver&&!this._isHintActive&&!this._isAutoPlaying&&this.mainNode.active&&this._animationComplete){if(this._isFirstMovePending)return;this._idleTimer+=t,this._idleTimer>=this.idleHintDelay&&this.showDynamicHint()}},r.resetIdleTimer=function(){this._isAutoPlaying||(this._idleTimer=0,this.hideDynamicHint())},r.addValidMove=function(t){this._gameWon||this._gameOver||this._isAutoPlaying||(this._isFirstMovePending&&(this._isFirstMovePending=!1,this.hideHandTutorial()),this.resetIdleTimer(),this.ensureAudioPlays(),this._currentMoves--,this.updateMovesLabel(),this._movesMade++,5===this._movesMade&&this.showPopup(),this._currentMoves<=0?this.triggerLoseState():this.checkFoundationWinCondition())},r.showPopup=function(){if(this.popupNode){this.popupNode.active=!0;var t=this.popupNode.getComponent(p)||this.popupNode.addComponent(p);t.opacity=0,this.popupNode.setScale(new f(.5,.5,1)),v(t).to(.3,{opacity:255}).start(),v(this.popupNode).to(.4,{scale:new f(1,1,1)},{easing:"backOut"}).start(),g.on(m.EventType.TOUCH_START,this.hidePopup,this)}},r.hidePopup=function(){var t=this;if(this.popupNode&&this.popupNode.active){g.off(m.EventType.TOUCH_START,this.hidePopup,this);var e=this.popupNode.getComponent(p);e&&v(e).to(.2,{opacity:0}).start(),v(this.popupNode).to(.2,{scale:new f(.8,.8,1)},{easing:"backIn"}).call((function(){t.popupNode.active=!1})).start()}},r.startGameLogic=function(){var t=this;this.mainNode&&(this.mainNode.active=!0,this.hideTableauCards(),v(this.mainNode.getComponent(p)||this.mainNode.addComponent(p)).to(.3,{opacity:255}).call((function(){t.animateCardsDropping()})).start())},r.hideTableauCards=function(){this.tableauNodes.forEach((function(t){var e=t.getComponent("CardLogic");t.children.filter((function(t){return t.active&&t!==(null==e?void 0:e.placeholderNode)&&(t.name.startsWith("card")||t.name.includes("faceDown"))})).forEach((function(t){(t.getComponent(p)||t.addComponent(p)).opacity=0}))}))},r.animateCardsDropping=function(){var t=this,e=[],n=this.stockNode.getWorldPosition(),i=this.stockNode.getScale().clone(),o=this.wasteNode.getScale().clone();this.stockNode.setScale(new f(0,0,1)),this.wasteNode.setScale(new f(0,0,1)),this.tableauNodes.forEach((function(t,i){var o=t.getComponent("CardLogic");t.children.filter((function(t){return t.active&&t!==(null==o?void 0:o.placeholderNode)&&(t.name.startsWith("card")||t.name.includes("faceDown"))})).forEach((function(t,o){var a,r=t.getPosition().clone(),s=null==(a=t.parent)?void 0:a.getComponent(y),c=s?s.convertToNodeSpaceAR(n):new f(0,0,0);e.push({node:t,originalX:r.x,originalY:r.y,originalZ:r.z,column:i,row:o,startPos:c})}))})),e.sort((function(t,e){return t.column===e.column?t.row-e.row:t.column-e.column}));var a=0;e.forEach((function(e,n){var i=e.node,o=e.startPos,r=new f(e.originalX,e.originalY,e.originalZ);i.setPosition(o),i.setScale(new f(0,0,1)),i.angle=180;var s=i.getComponent(p);s&&(s.opacity=255);var c=(o.x+r.x)/2,l=(o.y+r.y)/2+300,u=new f(c,l,0),h=.1+.08*n;a=Math.max(a,h+.6),n%3==0&&t.scheduleOnce((function(){t._audioSource&&t.cardDropSound&&t._audioSource.playOneShot(t.cardDropSound,.3)}),h);v({t:0}).delay(h).to(.6,{t:1},{easing:"sineOut",onUpdate:function(t){var e=t.t,n=1-e,a=e*e,s=n*n,c=s*o.x+2*n*e*u.x+a*r.x,l=s*o.y+2*n*e*u.y+a*r.y;i.setPosition(c,l,0),i.angle=180-180*e;var h=4*e*(1-e)*.5;i.setScale(1+h,1+h,1)}}).call((function(){i.setPosition(r),i.angle=0,v(i).to(.1,{scale:new f(1.15,.85,1)}).to(.1,{scale:new f(1,1,1)}).start()})).start()})),this.scheduleOnce((function(){t.popInNode(t.stockNode,i),t.popInNode(t.wasteNode,o)}),.6*a),this.scheduleOnce((function(){t._animationComplete=!0,t._isFirstMovePending&&t.showIntroMessage()}),a+.8)},r.popInNode=function(t,e){t&&(t.active=!0,t.setScale(new f(0,0,1)),this.ensureCardsVisible(t),v(t).to(.4,{scale:e},{easing:"elasticOut"}).start())},r.ensureCardsVisible=function(t){var e=t.getComponent("CardLogic");t.children.filter((function(t){return t.active&&t!==(null==e?void 0:e.placeholderNode)&&t!==(null==e?void 0:e.visualDeckTop)&&t!==(null==e?void 0:e.emptyStockVisual)})).forEach((function(t){var e=t.getComponent(p);e&&(e.opacity=255)}))},r.showIntroMessage=function(){if(this.introNode){this._isIntroShowing=!0,this.introNode.active=!0;var t=this.introNode.getComponent(p)||this.introNode.addComponent(p);t.opacity=0,v(t).to(.3,{opacity:255}).start(),this.introNode.on(c.EventType.TOUCH_END,this.hideIntroMessage,this),this.scheduleOnce(this.hideIntroMessage,3)}else this._isFirstMovePending&&this.showHandTutorial()},r.hideIntroMessage=function(){var t=this;if(this.introNode&&this._isIntroShowing){this._isIntroShowing=!1,this.unschedule(this.hideIntroMessage),this.introNode.off(c.EventType.TOUCH_END,this.hideIntroMessage,this);var e=this.introNode.getComponent(p);e?v(e).to(.3,{opacity:0}).call((function(){t.introNode.active=!1,t._isFirstMovePending&&t.showHandTutorial()})).start():(this.introNode.active=!1,this._isFirstMovePending&&this.showHandTutorial())}},r.refreshHandTutorial=function(){this._isFirstMovePending&&this._animationComplete&&!this._isIntroShowing&&(this.hideHandTutorial(),this.unschedule(this.showHandTutorial),this.scheduleOnce(this.showHandTutorial,.1))},r.showHandTutorial=function(){var t=this;if(this.handNode&&this._isFirstMovePending){var e=this.findBestMove();if(e&&e.from&&this.handNode.parent){this.handNode.active=!0,N.stopAllByTarget(this.handNode);var n=this.handNode.getComponent(p)||this.handNode.addComponent(p),i=this.handNode.parent.getComponent(y);if(!i)return;var o=new f(40,-60,0),a=e.from.getWorldPosition(),r=i.convertToNodeSpaceAR(a).add(o);if(e.to){var s=e.to.getWorldPosition(),c=i.convertToNodeSpaceAR(s).add(o);n.opacity=0,this.handNode.angle=0,v(this.handNode).repeatForever(v().call((function(){t.handNode.setPosition(r),t.handNode.angle=0})).parallel(v(n).to(.3,{opacity:255}),v(this.handNode).to(.3,{scale:new f(1.1,1.1,1)})).to(.2,{scale:new f(.9,.9,1),angle:-5},{easing:"sineOut"}).to(.8,{position:c},{easing:"sineInOut"}).to(.2,{scale:new f(1.1,1.1,1),angle:0},{easing:"sineIn"}).parallel(v(n).to(.3,{opacity:0}),v(this.handNode).to(.3,{scale:new f(1,1,1)})).delay(.4)).start()}else n.opacity=0,this.handNode.angle=0,v(this.handNode).repeatForever(v().call((function(){t.handNode.setPosition(r)})).parallel(v(n).to(.3,{opacity:255}),v(this.handNode).to(.3,{scale:new f(1.1,1.1,1)})).delay(.2).to(.15,{scale:new f(.85,.85,1),angle:-8},{easing:"sineOut"}).to(.15,{scale:new f(1.1,1.1,1),angle:0},{easing:"sineIn"}).delay(.3).parallel(v(n).to(.3,{opacity:0}),v(this.handNode).to(.3,{scale:new f(1,1,1)})).delay(.4)).start()}}},r.hideHandTutorial=function(){this.handNode&&(N.stopAllByTarget(this.handNode),this.handNode.active=!1)},r.onCardRevealed=function(){this._isAutoPlaying||(this._revealedCount++,this._revealedCount>=this._totalHiddenCards&&this.startAutoWinSequence())},r.startAutoWinSequence=function(){this._isAutoPlaying||(this._isAutoPlaying=!0,this.hideDynamicHint(),this.schedule(this.processNextAutoMove,.08))},r.processNextAutoMove=function(){for(var t=!1,e=Math.floor(4*Math.random()),n=0;n<4;n++){var i=(n+e)%4,o=this.foundationNodes[i],a=this.getNextNeededCard(o);if(a){var r=this.findCardGlobally(a.suit,a.rank);if(r){this.animateAutoMove(r,o),t=!0;break}}}var s=0;this.foundationNodes.forEach((function(t){return s+=t.children.filter((function(t){return t.name.startsWith("card")})).length})),(s>=52||!t&&s>=52)&&(this.unschedule(this.processNextAutoMove),this.triggerWinState())},r.getNextNeededCard=function(t){var e=this,n=this.getTopCard(t);if(!n){for(var i=this.foundationNodes.map((function(t){return e.getTopCard(t)})).filter((function(t){return null!==t})).map((function(t){return Math.floor(parseInt(t.name.replace("card",""))/13)})),o=0;o<4;o++)if(-1===i.indexOf(o))return{suit:o,rank:0};return null}var a=parseInt(n.name.replace("card","")),r=a%13,s=Math.floor(a/13);return 12===r?null:{suit:s,rank:r+1}},r.findCardGlobally=function(t,e){for(var n,o="card"+("000"+(13*t+e)).slice(-3),a=i(this.tableauNodes);!(n=a()).done;){var r=n.value.children.find((function(t){return t.name===o}));if(r)return r}var s=this.wasteNode.children.find((function(t){return t.name===o}));if(s)return s;var c=this.stockNode.children.find((function(t){return t.name===o}));return c||null},r.animateAutoMove=function(t,e){var n=t.getWorldPosition();t.setParent(e),t.setPosition(0,0,0),t.setWorldPosition(n),v(t).to(.15,{position:new f(0,0,0)},{easing:"sineOut"}).call((function(){t.setScale(1,1,1)})).start()},r.showDynamicHint=function(){if(this._animationComplete){var t=this.findBestMove();if(t&&(this._isHintActive=!0,this.stackOutline&&t.from)){var e=1;if(t.from.parent&&-1!==this.tableauNodes.indexOf(t.from.parent)){var n=t.from.parent.children,i=n.indexOf(t.from);-1!==i&&(e=n.length-i)}this.stackOutline.show(t.from,e)}}},r.hideDynamicHint=function(){this.stackOutline&&this.stackOutline.clear(),this._isHintActive=!1},r.findBestMove=function(){for(var t=[],e=0;e<this.tableauNodes.length;e++){var n=this.tableauNodes[e],o=n.children.filter((function(t){return t.active&&t.name.startsWith("card")}));if(0!==o.length)for(var a,r=i(o);!(a=r()).done;){var s=a.value;if(s===o[o.length-1]){var c=this.checkFoundationMoves(s).node;c&&t.push({type:"TableauToFoundation",from:s,to:c,score:100})}var l=this.checkTableauMoves(s,e);if(l){var u=s.getSiblingIndex(),h=n.children[u-1],d=h&&h.name.includes("faceDown"),p=1===u,f=l.children.length>1;d?t.push({type:"RevealHiddenCard",from:s,to:l,score:90}):p&&f?t.push({type:"ClearTableauSlot",from:s,to:l,score:50}):t.push({type:"TableauReposition",from:s,to:l,score:10})}}}var v=this.getTopCard(this.wasteNode);if(v){var g=this.checkFoundationMoves(v).node;g&&t.push({type:"WasteToFoundation",from:v,to:g,score:80});var m=this.checkTableauMoves(v,-1);m&&t.push({type:"WasteToTableau",from:v,to:m,score:60})}if(this.stockNode.children.filter((function(t){return t.name.startsWith("card")||t.name.includes("faceDown")})).length>0)t.push({type:"DrawStock",from:this.stockNode,score:40});else{var y,N=this.stockNode.getComponent("CardLogic");this.wasteNode.children.filter((function(t){return t.name.startsWith("card")})).length>0&&N&&(null==(y=N.emptyStockVisual)||!y.active)&&t.push({type:"RestackStock",from:this.stockNode,score:40})}return 0===t.length?null:(t.sort((function(t,e){return e.score-t.score})),t[0])},r.checkFoundationMoves=function(t){var e,n=null==(e=t.parent)?void 0:e.getComponent("CardLogic"),o=null==n?void 0:n.getCardData(t);if(!o)return{node:null};for(var a,r=i(this.foundationNodes);!(a=r()).done;){var s=a.value,c=s.getComponent("CardLogic"),l=this.getTopCard(s);if(l){var u=null==c?void 0:c.getCardData(l);if(u&&u.suit===o.suit&&o.value===u.value+1)return{node:s}}else if(0===o.value)return{node:s}}return{node:null}},r.checkTableauMoves=function(t,e){var n,i=null==(n=t.parent)?void 0:n.getComponent("CardLogic"),o=null==i?void 0:i.getCardData(t);if(!o)return null;for(var a=0;a<this.tableauNodes.length;a++)if(a!==e){var r=this.tableauNodes[a],s=r.getComponent("CardLogic"),c=this.getTopCard(r);if(c){var l=null==s?void 0:s.getCardData(c);if(l){var u=l.isRed!==o.isRed,h=l.value===o.value+1;if(u&&h)return r}}else if(12===o.value)return r}return null},r.checkFoundationWinCondition=function(){if(!(this._gameWon||this._gameOver||this._isAutoPlaying)){var t=0;this.foundationNodes.forEach((function(e){return t+=e.children.filter((function(t){return t.name.startsWith("card")})).length})),t>=52&&this.triggerWinState()}},r.triggerWinState=function(){var t=this;this._gameWon||(this._gameWon=!0,this.scheduleOnce((function(){t.showCTA()}),.5))},r.getTopCard=function(t){if(!t)return null;var e=t.children.filter((function(t){return t.active&&t.name.startsWith("card")}));return e.length>0?e[e.length-1]:null},r.updateMovesLabel=function(){this.movesLabel&&(this.movesLabel.string=""+this._currentMoves)},r.triggerLoseState=function(){var t=this;this._gameWon||this._gameOver||(this._gameOver=!0,this.hideDynamicHint(),this.scheduleOnce((function(){t.showYouLostScreen()}),.5))},r.showYouLostScreen=function(){var t=this;if(this.youLostScreen){this.youLostScreen.active=!0;var e=this.youLostScreen.getComponent(p)||this.youLostScreen.addComponent(p);e.opacity=0,v(e).to(.3,{opacity:255}).start(),this.youLostScreen.setScale(new f(0,0,1)),v(this.youLostScreen).to(.5,{scale:new f(1.15,1.15,1)},{easing:"backOut"}).to(.3,{scale:new f(1,1,1)},{easing:"sineInOut"}).call((function(){t.playYouLostPulse()})).start()}},r.initBGM=function(){this.bgmClip&&(this._audioSource=this.node.getComponent(C)||this.node.addComponent(C),this._audioSource.clip=this.bgmClip,this._audioSource.loop=!0,this._audioSource.playOnAwake=!0,this._audioSource.volume=.5,this._audioSource.play())},r.ensureAudioPlays=function(){this._audioSource&&!this._audioSource.playing&&this._audioSource.play()},r.setupInitialState=function(){this.mainNode&&(this.mainNode.active=!1),this.ctaScreen&&(this.ctaScreen.active=!1),this.youLostScreen&&(this.youLostScreen.active=!1),this.introNode&&(this.introNode.active=!1),this.popupNode&&(this.popupNode.active=!1),this._movesMade=0,this._currentMoves=this.maxMoves,this.updateMovesLabel(),this.stackOutline&&this.stackOutline.clear()},r.startSequence=function(){this.startGameLogic()},r.showCTA=function(){var t=this;if(this.ctaScreen&&!this.ctaScreen.active){this.ctaScreen.active=!0;var e=this.ctaScreen.getComponent(p)||this.ctaScreen.addComponent(p);e.opacity=0,v(e).to(.3,{opacity:255}).start(),this.ctaScreen.setScale(new f(0,0,1)),v(this.ctaScreen).to(.5,{scale:new f(1.15,1.15,1)},{easing:"backOut"}).to(.3,{scale:new f(1,1,1)},{easing:"sineInOut"}).call((function(){t.playCTAPulse()})).start()}},r.playCTAPulse=function(){var t=this;b(this.ctaScreen)&&(v(this.ctaScreen).repeatForever(v().to(.8,{scale:new f(1.05,1.05,1)},{easing:"sineInOut"}).to(.8,{scale:new f(1,1,1)},{easing:"sineInOut"})).start(),this.playEpicConfetti(),this.schedule((function(){t.ctaScreen.active&&t.playEpicConfetti()}),1.6))},r.playYouLostPulse=function(){b(this.youLostScreen)&&v(this.youLostScreen).repeatForever(v().to(.8,{scale:new f(1.05,1.05,1)},{easing:"sineInOut"}).to(.8,{scale:new f(1,1,1)},{easing:"sineInOut"})).start()},r.playEpicConfetti=function(){var t=this,e=[new w(255,215,0,255),new w(100,255,150,255),new w(255,255,255,255)];this.createMysticBurst(0,-150,80,e),this.scheduleOnce((function(){t.createEnchantedCascade(e,40)}),.3),this.scheduleOnce((function(){t.createEnchantedCascade(e,35)}),1.2),this.scheduleOnce((function(){t.createEnchantedCascade(e,35)}),2.4)},r.createMysticBurst=function(t,e,n,i){var o=this;if(this.confettiPrefab&&this.confettiContainer)for(var a=function(){var n=S(o.confettiPrefab);o.confettiContainer.addChild(n);var a=n.getComponent(_),r=n.getComponent(p)||n.addComponent(p);r.opacity=255,a&&(a.color=i[Math.floor(Math.random()*i.length)]);var s=.3*Math.random()+.15;n.setScale(new f(s,s,1)),n.setPosition(t,e,0);var c=Math.random()*Math.PI*2,l=700*Math.random()+300,u=t+Math.cos(c)*l,h=e+Math.sin(c)*l,d=.4*Math.random()+.2,g=1.5*Math.random()+1,m={t:0};v(m).to(d,{t:1},{easing:"expoOut",onUpdate:function(i){var o=i.t,a=P.lerp(t,u,o),r=P.lerp(e,h,o);n.setPosition(a,r,0),n.angle=720*o}}).call((function(){m.t=0})).to(g,{t:1},{easing:"sineOut",onUpdate:function(t){var e=t.t,i=P.lerp(h,h-80,e);n.setPosition(u,i,0),r.opacity=P.lerp(255,0,e),n.angle+=2}}).call((function(){n.destroy()})).start()},r=0;r<n;r++)a()},r.createEnchantedCascade=function(t,e){var n=this;if(this.confettiPrefab&&this.confettiContainer)for(var i=M.getVisibleSize(),o=function(){var e=S(n.confettiPrefab);n.confettiContainer.addChild(e);var o=e.getComponent(_),a=e.getComponent(p)||e.addComponent(p);o&&(o.color=t[Math.floor(Math.random()*t.length)]);var r=Math.random()*i.width-i.width/2,s=i.height/2+100+300*Math.random();e.setPosition(r,s,0);var c=Math.random()>.85,l=c?.5*Math.random()+.4:.2*Math.random()+.1;e.setScale(new f(l,l,1));var u=c?255:160,h=4*Math.random()+2.5,d=200*Math.random()+50,g=1.5*Math.random()+.5,m=4*Math.random()+2,y=4*Math.random()+1,N=Math.random()>.5?1:-1,C=(3*Math.random()+.5)*N;v({t:0}).to(h,{t:1},{onUpdate:function(t){var n=t.t,o=P.lerp(s,-i.height/2-150,n),c=Math.sin(n*Math.PI*g)*d,h=Math.cos(n*Math.PI*m)*(.25*d);e.setPosition(r+c+h,o,0);var p=Math.cos(n*Math.PI*y);e.setScale(new f(p*l,l,1)),e.angle+=C,a.opacity=n<.1?P.lerp(0,u,10*n):n>.8?P.lerp(u,0,(n-.8)/.2):u}}).call((function(){e.destroy()})).start()},a=0;a<e;a++)o()},e}(T)).prototype,"introNode",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(j.prototype,"handNode",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(j.prototype,"popupNode",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(j.prototype,"mainNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=e(j.prototype,"ctaScreen",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),et=e(j.prototype,"youLostScreen",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=e(j.prototype,"globalOverlay",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=e(j.prototype,"bgmClip",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=e(j.prototype,"cardDropSound",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=e(j.prototype,"confettiPrefab",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=e(j.prototype,"confettiContainer",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=e(j.prototype,"movesLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=e(j.prototype,"maxMoves",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),lt=e(j.prototype,"tableauNodes",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ut=e(j.prototype,"foundationNodes",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ht=e(j.prototype,"stockNode",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=e(j.prototype,"wasteNode",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(j.prototype,"stackOutline",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=e(j.prototype,"idleHintDelay",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),X=j))||X));r._RF.pop()}}}));

System.register("chunks:///_virtual/glow.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,o,e,n,a,r,c,p,u;return{setters:[function(t){i=t.applyDecoratedDescriptor,o=t.inheritsLoose,e=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,r=t._decorator,c=t.UIOpacity,p=t.tween,u=t.Component}],execute:function(){var l,s,y,f,h,m,O,g,w;a._RF.push({},"6105bBsqCxHMKEZH1vHm5ZR","glow",void 0);var d=r.ccclass,b=r.property;t("GlowEffect",(l=d("GlowEffect"),s=b({tooltip:"Minimum opacity (0-255)"}),y=b({tooltip:"Maximum opacity (0-255)"}),f=b({tooltip:"Duration for one half of the glow cycle"}),l((O=i((m=function(t){function i(){for(var i,o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return i=t.call.apply(t,[this].concat(a))||this,e(i,"minOpacity",O,n(i)),e(i,"maxOpacity",g,n(i)),e(i,"duration",w,n(i)),i._uiOpacity=null,i}o(i,t);var a=i.prototype;return a.onLoad=function(){this._uiOpacity=this.getComponent(c)||this.addComponent(c),this.startGlow()},a.startGlow=function(){this._uiOpacity.opacity=this.minOpacity,p(this._uiOpacity).repeatForever(p().to(this.duration,{opacity:this.maxOpacity},{easing:"sineInOut"}).to(this.duration,{opacity:this.minOpacity},{easing:"sineInOut"})).start()},a.stopGlow=function(){p(this._uiOpacity).stop(),this._uiOpacity.opacity=255},i}(u)).prototype,"minOpacity",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),g=i(m.prototype,"maxOpacity",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),w=i(m.prototype,"duration",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),h=m))||h));a._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./Card.ts","./GameManager.ts","./flip.ts","./front_back.ts","./glow.ts","./react.ts","./resolutionManager.ts","./scale.ts","./stackOutline.ts","./wrong.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/react.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,o,i,a,c,l;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,c=e.Node,l=e.Component}],execute:function(){var s,p,u;i._RF.push({},"6b4788uzrBHrJea4/v4Zm/+","react",void 0);var d=a.ccclass,g=a.property;e("CTARedirect",d("CTARedirect")((u=t((p=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,n(t,"targetUrl",u,o(t)),t}r(t,e);var i=t.prototype;return i.onLoad=function(){this.node.on(c.EventType.TOUCH_START,this.onButtonClick,this)},i.onButtonClick=function(){console.log("[CTARedirect] Opening URL: "+this.targetUrl),window.open(this.targetUrl,"_blank")},t}(l)).prototype,"targetUrl",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://play.google.com/store/apps/details?id=nova.solitaire.patience.card.games.klondike.free"}}),s=p))||s);i._RF.pop()}}}));

System.register("chunks:///_virtual/resolutionManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(t){var e,a,i,r,n,o,c,l,s,u,p,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){n=t.cclegacy,o=t._decorator,c=t.Node,l=t.view,s=t.ResolutionPolicy,u=t.UITransform,p=t.Component},function(t){g=t.GameManager}],execute:function(){var d,h,f,I,b,v,m,y,L,z,U,k,w,B,M,R,D,S,T,_,F;n._RF.push({},"0f3ceix4BlOZr4K416AGtjd","resolutionManager",void 0);var G=o.ccclass,H=o.property;t("ResolutionManager",(d=G("ResolutionManager"),h=H(c),f=H(c),I=H(c),b=H(c),v=H(c),m=H(c),y=H(c),L=H(c),z=H(g),d((w=e((k=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,i(e,"portraitLogo",w,r(e)),i(e,"landscapeLogo",B,r(e)),i(e,"portraitUI",M,r(e)),i(e,"landscapeUI",R,r(e)),i(e,"portraitBackground",D,r(e)),i(e,"landscapeBackground",S,r(e)),i(e,"portraitIcon",T,r(e)),i(e,"landscapeIcon",_,r(e)),i(e,"gameManager",F,r(e)),e}a(e,t);var n=e.prototype;return n.onLoad=function(){var t=this;l.setResizeCallback((function(){return t.updateLayout()})),this.updateLayout()},n.updateLayout=function(){var t,e=l.getFrameSize(),a=e.width>e.height;a?l.setDesignResolutionSize(1440,720,s.FIXED_HEIGHT):l.setDesignResolutionSize(720,1440,s.FIXED_WIDTH),a?(this.landscapeLogo&&(this.landscapeLogo.active=!0),this.landscapeUI&&(this.landscapeUI.active=!0),this.landscapeBackground&&(this.landscapeBackground.active=!0),this.portraitLogo&&(this.portraitLogo.active=!1),this.portraitUI&&(this.portraitUI.active=!1),this.portraitBackground&&(this.portraitBackground.active=!1),this.landscapeIcon&&(this.landscapeIcon.active=!0),this.portraitIcon&&(this.portraitIcon.active=!1),console.log("Switched to Landscape UI")):(this.portraitLogo&&(this.portraitLogo.active=!0),this.portraitUI&&(this.portraitUI.active=!0),this.portraitBackground&&(this.portraitBackground.active=!0),this.landscapeLogo&&(this.landscapeLogo.active=!1),this.landscapeUI&&(this.landscapeUI.active=!1),this.landscapeBackground&&(this.landscapeBackground.active=!1),this.portraitIcon&&(this.portraitIcon.active=!0),this.landscapeIcon&&(this.landscapeIcon.active=!1),console.log("Switched to Portrait UI")),null==(t=this.node.getComponent(u))||t.setContentSize(l.getVisibleSize()),this.gameManager&&(console.log("[ResolutionManager] Layout changed -> Resetting Guide Timer"),this.gameManager.resetIdleTimer(),this.gameManager.refreshHandTutorial())},e}(p)).prototype,"portraitLogo",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(k.prototype,"landscapeLogo",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(k.prototype,"portraitUI",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(k.prototype,"landscapeUI",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(k.prototype,"portraitBackground",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(k.prototype,"landscapeBackground",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(k.prototype,"portraitIcon",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(k.prototype,"landscapeIcon",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(k.prototype,"gameManager",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=k))||U));n._RF.pop()}}}));

System.register("chunks:///_virtual/scale.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,a,r,o,c,l,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,c=t.Vec3,l=t.tween,s=t.Component}],execute:function(){var u,p,h,g;r._RF.push({},"3fa65BV3eZL1YfDgvgkiCEP","scale",void 0);var f=o.ccclass,d=o.property;t("PeriodicScaler",f("PeriodicScaler")((h=e((p=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,n(e,"targetScale",h,a(e)),n(e,"duration",g,a(e)),e._initialScale=new c(1,1,1),e}i(e,t);var r=e.prototype;return r.onLoad=function(){this._initialScale=this.node.getScale(),this.startPulsing()},r.startPulsing=function(){var t=new c(this._initialScale.x*this.targetScale,this._initialScale.y*this.targetScale,this._initialScale.z);l(this.node).repeatForever(l().to(this.duration,{scale:t},{easing:"sineInOut"}).to(this.duration,{scale:this._initialScale},{easing:"sineInOut"})).start()},r.stopPulsing=function(){l(this.node).stop()},e}(s)).prototype,"targetScale",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.1}}),g=e(p.prototype,"duration",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.8}}),u=p))||u);r._RF.pop()}}}));

System.register("chunks:///_virtual/stackOutline.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,o,n,r,l,s,a,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,s=t.Node,a=t.UITransform,c=t.Vec3,u=t.Component}],execute:function(){var d,h,p,f,v;r._RF.push({},"5879bRK9KdEz6ohEMTTULET","stackOutline",void 0);var y=l.ccclass,N=l.property;t("StackOutline",(d=y("StackOutline"),h=N({type:s,tooltip:"Drag the child Outline Sprite here"}),d((v=e((f=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),l=0;l<i;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r))||this,o(e,"outlineNode",v,n(e)),e.CARD_HEIGHT=230,e.STACK_OFFSET=70,e}i(e,t);var r=e.prototype;return r.onLoad=function(){this.outlineNode&&(this.outlineNode.active=!1)},r.show=function(t,e){if(t&&this.outlineNode){this.outlineNode.active=!0;var i=this.CARD_HEIGHT+(e-1)*this.STACK_OFFSET,o=this.outlineNode.getComponent(a);o&&o.setContentSize(o.width,i);var n=t.getWorldScale();this.outlineNode.setWorldScale(n);var r=t.getWorldPosition(),l=.5*this.CARD_HEIGHT*n.y;this.outlineNode.setWorldPosition(new c(r.x,r.y+l,r.z))}},r.clear=function(){this.outlineNode&&(this.outlineNode.active=!1)},e}(u)).prototype,"outlineNode",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=f))||p));r._RF.pop()}}}));

System.register("chunks:///_virtual/wrong.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var o,t,r,n,i,a,c,s,u,l,d,p,h,S,y,f,g;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,c=e.SpriteFrame,s=e.AudioClip,u=e.AudioSource,l=e.Node,d=e.Vec3,p=e.Sprite,h=e.UIOpacity,S=e.UITransform,y=e.tween,f=e.isValid,g=e.Component}],execute:function(){var w,C,b,k,m,F,v;i._RF.push({},"c0c76/Jst1P3pIWuZPLu2M8","wrong",void 0);var _=a.ccclass,T=a.property;e("GridFeedback",(w=_("GridFeedback"),C=T(c),b=T(s),w((F=o((m=function(e){function o(){for(var o,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return o=e.call.apply(e,[this].concat(i))||this,r(o,"wrongClickSprite",F,n(o)),r(o,"errorSound",v,n(o)),o._audioSource=null,o}t(o,e);var i=o.prototype;return i.onLoad=function(){this._audioSource=this.getComponent(u)||this.addComponent(u),this.node.on(l.EventType.TOUCH_START,this.onGridClicked,this)},i.onGridClicked=function(e){var o=e.getUILocation(),t=new d(o.x,o.y,0);this.playErrorSFX(),this.showWrongFeedback(t)},i.playErrorSFX=function(){this.errorSound&&this._audioSource&&this._audioSource.playOneShot(this.errorSound,1)},i.showWrongFeedback=function(e){var o=new l("WrongClickFeedback"),t=o.addComponent(p),r=o.addComponent(h),n=o.addComponent(S);t.spriteFrame=this.wrongClickSprite,n.setContentSize(100,100),this.node.addChild(o),o.setWorldPosition(e),y(r).to(.1,{opacity:255}).delay(.4).to(.5,{opacity:0}).call((function(){f(o)&&o.destroy()})).start(),o.setScale(new d(.5,.5,1)),y(o).to(.15,{scale:new d(1.2,1.2,1)},{easing:"backOut"}).to(.1,{scale:new d(1,1,1)}).start()},o}(g)).prototype,"wrongClickSprite",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=o(m.prototype,"errorSound",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=m))||k));i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});